<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.3.9: http://docutils.sourceforge.net/" />
<title>QuickyPix: Installation</title>
<link rel="stylesheet" type="text/css" href="/css/screen.css" media="screen, tv, projection" title="Default" />
<link rel="stylesheet" type="text/css" href="/css/print.css" media="print" />
<link rel="stylesheet" href="style.css" type="text/css" />
</head>
<body>
<div class="document" id="quickypix-installation">
<h1 class="title">QuickyPix: Installation</h1>
<p>QuickyPix has three modes:</p>
<ul class="simple">
<li>REGULAR mode is what users see.</li>
<li>ADMIN mode is what users see, plus a &quot;EDIT&quot; link to EDIT mode.<ul>
<li>Authentication: none.  It's just a convenience.</li>
<li>To enter admin mode: append <tt class="docutils literal"><span class="pre">?admin=1</span></tt> to URL.  This will set a
permanent cookie.</li>
</ul>
</li>
<li>EDIT mode allows editing: album comment, album name, pic comment; rename pic;
delete pic (with tdel).<ul>
<li>Authentication: web server. I.e., authenticated if <tt class="docutils literal"><span class="pre">REMOTE_USER</span></tt> is set.<ul>
<li>You can set up whatever authentication and/or encryption (e.g. SSL)
you want</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="configuration">
<h1><a name="configuration">Configuration</a></h1>
<p>Edit <tt class="docutils literal"><span class="pre">config.py</span></tt>, setting at least these settings:</p>
<pre class="literal-block">
# Directory tree containing pictures
ALBUMS_DIR = '/path/to/pictures'

# Directory to write cache files, must be writable by Apache CGI/SCGI user
CACHE_DIR = '/path/to/cache'

# File to write log data, must be writable by Apache CGI/SCGI user
#   One way to do this as root: 
#      touch /var/log/quickypix.log; chown www-data /var/log/quickypix.log
LOG_PATH = '/path/to/logfile'

# An example is in html/template.html
TEMPLATES_FILE = '/path/to/template.html'

# An example is in html/style.css
STYLE_FILE = '/path/to/style.css'
</pre>
<p>If you use admin mode, you need to set:</p>
<pre class="literal-block">
EDIT_ROOT = 'https://private.photo.site.example.com/'

PUBLIC_ROOT = 'http://public.photo.site.example.com/'
</pre>
</div>
<div class="section" id="cgi">
<h1><a name="cgi">CGI</a></h1>
<div class="section" id="apache-cgi-sample-configuration">
<h2><a name="apache-cgi-sample-configuration">Apache CGI sample configuration</a></h2>
<pre class="literal-block">
&lt;Directory /home/quarl/proj/quickypix&gt;
    Options ExecCGI
    Order allow,deny
    Allow from all
&lt;/Directory&gt;

# Note: the trailing slash after quickypix.cgi is significant!
ScriptAlias / /home/quarl/proj/quickypix/src/quickypix/quickypix.cgi/
</pre>
</div>
<div class="section" id="lighttpd-cgi-sample-configuration">
<h2><a name="lighttpd-cgi-sample-configuration"><a class="reference" href="http://www.lighttpd.net/">Lighttpd</a> CGI sample configuration</a></h2>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">lighttpd.conf</span></tt>:</p>
<pre class="literal-block">
cgi.assign = ( &quot;.py&quot; =&gt; &quot;/usr/bin/python&quot; )
url.rewrite = ( &quot;^/(.*)$&quot; =&gt; &quot;/quickypix.cgi/$1&quot; )
</pre>
</li>
<li><p class="first">Create a symlink to <tt class="docutils literal"><span class="pre">quickypix.cgi</span></tt> from the
<tt class="docutils literal"><span class="pre">server.document-root</span></tt> directory.</p>
</li>
<li><p class="first">lighttpd has a problem where the CGI <tt class="docutils literal"><span class="pre">SCRIPT_NAME</span></tt> environment
variable is set to a non-virtual path; i.e. it is the post-redirect path
to the script.  Thus, you must hardcode QuickyPix's notion of root
in <tt class="docutils literal"><span class="pre">config.py</span></tt>:</p>
<pre class="literal-block">
root = ''
</pre>
</li>
</ul>
</div>
</div>
<div class="section" id="scgi">
<h1><a name="scgi">SCGI</a></h1>
<p><a class="reference" href="#scgi">SCGI</a> (like FastCGI) reuses the QuickyPix python process, making it much more
efficient.</p>
<p>Arrange to have <tt class="docutils literal"><span class="pre">quickypix.scgi</span></tt> always running.  On Debian you can use
<tt class="docutils literal"><span class="pre">quickypix/src/init.d/quickypix.scgi</span></tt>.</p>
<div class="section" id="apache-scgi-sample-configuration">
<h2><a name="apache-scgi-sample-configuration">Apache SCGI sample configuration</a></h2>
<pre class="literal-block">
SCGIMount /photos/ 127.0.0.1:4010
</pre>
</div>
<div class="section" id="lighttpd-scgi-sample-configuration">
<h2><a name="lighttpd-scgi-sample-configuration">Lighttpd SCGI sample configuration</a></h2>
<p>Create a toplevel symlink to <tt class="docutils literal"><span class="pre">quickypix.scgi</span></tt> (in <tt class="docutils literal"><span class="pre">server.document-root</span></tt>).</p>
<p><tt class="docutils literal"><span class="pre">lighttpd.conf</span></tt>:</p>
<pre class="literal-block">
url.rewrite = ( &quot;^/photos(.*)$&quot; =&gt; &quot;/quickypix.scgi/$1&quot; )
scgi.server = ( &quot;.scgi&quot; =&gt;
                ( &quot;localhost&quot; =&gt;
                  ( 
                    &quot;host&quot; =&gt; &quot;127.0.0.1&quot;,
                    &quot;port&quot; =&gt; 4010,
                  )
                )
              )
</pre>
<p><tt class="docutils literal"><span class="pre">config.py</span></tt>:</p>
<pre class="literal-block">
root = '/photos'
</pre>
</div>
</div>
<div class="section" id="metadata">
<h1><a name="metadata">Metadata</a></h1>
<p>You can edit these manually, or through the web interface.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr><td><tt class="docutils literal"><span class="pre">album/.title</span></tt></td>
<td>album title</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">album/.comment</span></tt></td>
<td>album comment</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">album/.highlight</span></tt></td>
<td>highlighted picture (for album icon)</td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">album/pic.comment</span></tt></td>
<td>picture comment</td>
</tr>
</tbody>
</table>
<p>The included script <tt class="docutils literal"><span class="pre">convert_descript_ion</span></tt> converts 4DOS/ACDSee
<tt class="docutils literal"><span class="pre">descript.ion</span></tt> files to QuickyPix comment format.</p>
</div>
<div class="section" id="permissions-configuration">
<h1><a name="permissions-configuration">Permissions Configuration</a></h1>
<p>If you use EDIT mode, the following setup is recommended, for security.</p>
<p>Run normal-mode quickypix under a userid (e.g. <tt class="docutils literal"><span class="pre">photo-data-read</span></tt>) that can
only:</p>
<ul class="simple">
<li>Read the photo directory</li>
<li>Read and write to the cache directory</li>
</ul>
<p>Run edit-mode quickypix under a different userid (e.g. <tt class="docutils literal"><span class="pre">photo-data</span></tt>)
that can only:</p>
<ul class="simple">
<li>Read and write to the photo directory</li>
<li>Set <tt class="docutils literal"><span class="pre">config.ALWAYS_USE_PUBLIC_FOR_PHOTOS=True</span></tt> so you don't need access to
the cache directory</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">init.d/quickypix-scgi</span></tt> script runs the scgi process under a given user
id.</p>
<p>A small wrapper, <tt class="docutils literal"><span class="pre">src/wrapper/quickypix.cgi.su</span></tt>, is provided for running the
cgi process under a user id different from httpd.</p>
</div>
<div class="section" id="dependencies">
<h1><a name="dependencies">Dependencies</a></h1>
<ul class="simple">
<li>Python2.2+</li>
<li>PIL and/or ImageMagick (optional)<ul>
<li>QuickyPix uses PIL or ImageMagick (convert, identify) to get image
information and resize images</li>
<li>QuickyPix uses ImageMagick to rotate images, add &quot;movie&quot; labels</li>
</ul>
</li>
<li>MPlayer (optional)<ul>
<li>QuickyPix uses mencoder for rotating movies, making thumbnails</li>
</ul>
</li>
<li>Transcode (optional)<ul>
<li>QuickyPix uses tcprobe for getting movie information</li>
</ul>
</li>
</ul>
<!-- SCGI_: http://www.mems-exchange.org/software/scgi/ -->
</div>
</div>
<div class="footer">
<hr class="footer" />
<p>Karl Chen &lt;<a id="email" href="mailto:&#113;&#117;&#097;&#114;&#108;&#064;&#110;&#111;&#115;&#112;&#097;&#109;&#046;&#113;&#117;&#097;&#114;&#108;&#046;&#111;&#114;&#103;">&#113;&#117;&#097;&#114;&#108;<img src="" alt="&#064;" border="0"/>&#113;&#117;&#097;&#114;&#108;&#046;&#111;&#114;&#103;</a>&gt;<script type="text/javascript">addr = "q"+"u"+"a"+"r"+"l"+"@"+"q"+"u"+"a"+"r"+"l"+"."+"o"+"r"+"g";document.getElementById('email').innerHTML=addr;document.getElementById('email').href="mailto:"+addr;</script></p>
<p>Last modified 2005-12-16.</p>

</div>
</body>
</html>
